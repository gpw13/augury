<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="predict_lm_avg_trend() is a simple wrapper around predict_general_mdl_avg_trend().
For details surrounding the linear model fitting, please see
stats::lm() and for more details on the augury function this wraps around and the
various arguments this function accepts, please see predict_general_mdl_avg_trend()."><title>Use predict_lm on groups to generate average trend and apply to original data — predict_lm_avg_trend • augury</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use predict_lm on groups to generate average trend and apply to original data — predict_lm_avg_trend"><meta property="og:description" content="predict_lm_avg_trend() is a simple wrapper around predict_general_mdl_avg_trend().
For details surrounding the linear model fitting, please see
stats::lm() and for more details on the augury function this wraps around and the
various arguments this function accepts, please see predict_general_mdl_avg_trend()."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">augury</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/average-trend.html">Average trend modeling</a>
    <a class="dropdown-item" href="../articles/forecast-modeling.html">Forecast modeling</a>
    <a class="dropdown-item" href="../articles/inla-modeling.html">INLA modeling</a>
    <a class="dropdown-item" href="../articles/simple-methods.html">Simple prediction methods</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gpw13/augury/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Use <code>predict_lm</code> on groups to generate average trend and apply to original data</h1>
      <small class="dont-index">Source: <a href="https://github.com/gpw13/augury/blob/HEAD/R/predict_general_mdl_avg_trend_wrappers.R" class="external-link"><code>R/predict_general_mdl_avg_trend_wrappers.R</code></a></small>
      <div class="d-none name"><code>predict_lm_avg_trend.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>predict_lm_avg_trend()</code> is a simple wrapper around <code><a href="predict_general_mdl_avg_trend.html">predict_general_mdl_avg_trend()</a></code>.
For details surrounding the linear model fitting, please see
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code> and for more details on the augury function this wraps around and the
various arguments this function accepts, please see <code><a href="predict_general_mdl_avg_trend.html">predict_general_mdl_avg_trend()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">predict_lm_avg_trend</span><span class="op">(</span>
  <span class="va">df</span>,
  <span class="va">formula</span>,
  average_cols <span class="op">=</span> <span class="cn">NULL</span>,
  weight_col <span class="op">=</span> <span class="cn">NULL</span>,
  group_models <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">...</span>,
  ret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"df"</span>, <span class="st">"all"</span>, <span class="st">"error"</span>, <span class="st">"model"</span><span class="op">)</span>,
  scale <span class="op">=</span> <span class="cn">NULL</span>,
  probit <span class="op">=</span> <span class="cn">FALSE</span>,
  test_col <span class="op">=</span> <span class="cn">NULL</span>,
  test_period <span class="op">=</span> <span class="cn">NULL</span>,
  test_period_flex <span class="op">=</span> <span class="cn">NULL</span>,
  group_col <span class="op">=</span> <span class="st">"iso3"</span>,
  obs_filter <span class="op">=</span> <span class="cn">NULL</span>,
  sort_col <span class="op">=</span> <span class="st">"year"</span>,
  sort_descending <span class="op">=</span> <span class="cn">FALSE</span>,
  pred_col <span class="op">=</span> <span class="st">"pred"</span>,
  pred_upper_col <span class="op">=</span> <span class="st">"pred_upper"</span>,
  pred_lower_col <span class="op">=</span> <span class="st">"pred_lower"</span>,
  upper_col <span class="op">=</span> <span class="st">"upper"</span>,
  lower_col <span class="op">=</span> <span class="st">"lower"</span>,
  filter_na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"predictors"</span>, <span class="st">"response"</span>, <span class="st">"all"</span>, <span class="st">"none"</span><span class="op">)</span>,
  type_col <span class="op">=</span> <span class="cn">NULL</span>,
  types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"imputed"</span>, <span class="st">"imputed"</span>, <span class="st">"projected"</span><span class="op">)</span>,
  source_col <span class="op">=</span> <span class="cn">NULL</span>,
  source <span class="op">=</span> <span class="cn">NULL</span>,
  replace_obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"missing"</span>, <span class="st">"all"</span>, <span class="st">"none"</span><span class="op">)</span>,
  error_correct <span class="op">=</span> <span class="cn">FALSE</span>,
  error_correct_cols <span class="op">=</span> <span class="cn">NULL</span>,
  shift_trend <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>df</dt>
<dd><p>Data frame of model data.</p></dd>
<dt>formula</dt>
<dd><p>A formula that will be supplied to the model, such as <code>y~x</code>.
Variables defined in the formula will be used in the averaging. If the
variable is defined as part of <code>average_cols</code>, then it will be used within
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by()</a></code> prior to averaging. If it is not a part of <code>average_cols</code>,
then it must be a numeric column whose average will be taken.</p></dd>
<dt>average_cols</dt>
<dd><p>Column name(s) of column(s) for use in grouping data for averaging,
such as regions. If missing, uses global average of the data for infilling.</p></dd>
<dt>weight_col</dt>
<dd><p>Column name of column of weights to be used in averaging, such
as country population.</p></dd>
<dt>group_models</dt>
<dd><p>Logical, whether or not to run separate models for each group
defined by <code>average_cols</code>. If the <code>sort_col</code> is part of <code>average_cols</code>, then
it is not used to group models.</p></dd>
<dt>...</dt>
<dd><p>Other arguments passed to the model function.</p></dd>
<dt>ret</dt>
<dd><p>Character vector specifying what values the function returns. Defaults
to returning a data frame, but can return a vector of model error, the
model itself or a list with all 3 as components.</p></dd>
<dt>scale</dt>
<dd><p>Either <code>NULL</code> or a numeric value. If a numeric value is provided,
the response variable is scaled by the value passed to scale prior to model
fitting and prior to any probit transformation, so can be used to put the
response onto a 0 to 1 scale. Scaling is done by dividing the response by
the scale and using the <code><a href="scale_transform.html">scale_transform()</a></code> function. The response, as well
as the fitted values and confidence bounds are unscaled prior to error
calculation and returning to the user.</p></dd>
<dt>probit</dt>
<dd><p>Logical value on whether or not to probit transform the response
prior to model fitting. Probit transformation is performed after any scaling
determined by <code>scale</code> but prior to model fitting. The response, as well as
the fitted values and confidence bounds are untransformed prior to error
calculation and returning to the user.</p></dd>
<dt>test_col</dt>
<dd><p>Name of logical column specifying which response values to remove
for testing the model's predictive accuracy. If <code>NULL</code>, ignored. See <code><a href="model_error.html">model_error()</a></code>
for details on the methods and metrics returned.</p></dd>
<dt>test_period</dt>
<dd><p>Length of period to test for RMChE. If <code>NULL</code>, beginning and end
points of each group in <code>group_col</code> are compared. Otherwise, <code>test_period</code> must
be set to an integer <code>n</code> and for each group, comparisons are made between
the end point and <code>n</code> periods prior.</p></dd>
<dt>test_period_flex</dt>
<dd><p>Logical value indicating if <code>test_period</code> is less than
the full length of the series, should change error still be calculated for that
point. Defaults to <code>FALSE</code>.</p></dd>
<dt>group_col</dt>
<dd><p>Column name(s) of group(s) to use in <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by()</a></code> when
supplying type, calculating mean absolute scaled error on data involving
time series, and if <code>group_models</code>, then fitting and predicting models too.
If <code>NULL</code>, not used. Defaults to <code>"iso3"</code>.</p></dd>
<dt>obs_filter</dt>
<dd><p>String value of the form "<code>logical operator</code> <code>integer</code>"
that specifies when replacing observations by predicted values, this is
done where there is a specific number of observations. This is done in
conjunction with <code>group_col</code>. So, if <code>group_col = "iso3"</code> and
<code>obs_filter = "&gt;= 5"</code>, then for this model, predictions will only be used
for <code>iso3</code> vales that have 5 or more observations. Possible logical operators
to use are <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, and <code>!=</code>.</p></dd>
<dt>sort_col</dt>
<dd><p>Column name(s) to use to <code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">dplyr::arrange()</a></code> the data prior to
supplying type and calculating mean absolute scaled error on data involving
time series. If <code>NULL</code>, not used. Defaults to <code>"year"</code>.</p></dd>
<dt>sort_descending</dt>
<dd><p>Logical value on whether the sorted values from <code>sort_col</code>
should be sorted in descending order. Defaults to <code>FALSE</code>.</p></dd>
<dt>pred_col</dt>
<dd><p>Column name to store predicted value.</p></dd>
<dt>pred_upper_col</dt>
<dd><p>Column name to store upper bound of confidence interval
generated by the <code>predict_...</code> function. This stores the full set of generated
values for the upper bound.</p></dd>
<dt>pred_lower_col</dt>
<dd><p>Column name to store lower bound of confidence interval
generated by the <code>predict_...</code> function. This stores the full set of generated
values for the lower bound.</p></dd>
<dt>upper_col</dt>
<dd><p>Column name that contains upper bound information, including
upper bound of the input data to the model. Values from <code>pred_upper_col</code>
are put into this column in the exact same way the response is filled by <code>pred</code>
based on <code>replace_na</code> (only when there is a missing value in the response).</p></dd>
<dt>lower_col</dt>
<dd><p>Column name that contains lower bound information, including
lower bound of the input data to the model. Values from <code>pred_lower_col</code>
are put into this column in the exact same way the response is filled by <code>pred</code>
based on <code>replace_na</code> (only when there is a missing value in the response).</p></dd>
<dt>filter_na</dt>
<dd><p>Character value specifying how, if at all, to filter <code>NA</code>
values from the dataset prior to applying the model.  By default, all
observations with missing values are removed, although it can also remove
rows only if they have missing dependent or independent variables, or no
filtering at all.</p></dd>
<dt>type_col</dt>
<dd><p>Column name specifying data type.</p></dd>
<dt>types</dt>
<dd><p>Vector of length 3 that provides the type to provide to data
produced in the model. These values are only used to fill in type values
where the dependent variable is missing. The first value is given to missing
observations that precede the first observation, the second to those after
the last observation, and the third for those following the final observation.</p></dd>
<dt>source_col</dt>
<dd><p>Column name containing source information for the data frame.
If provided, the argument in <code>source</code> is used to fill in where predictions
have filled in missing data.</p></dd>
<dt>source</dt>
<dd><p>Source to add to missing values.</p></dd>
<dt>replace_obs</dt>
<dd><p>Character value specifying how, if at all, observations should
be replaced by fitted values. Defaults to replacing only missing values,
but can be used to replace all values or none.</p></dd>
<dt>error_correct</dt>
<dd><p>Logical value indicating whether or not whether mean error
should be used to adjust predicted values. If <code>TRUE</code>, the mean error between
observed and predicted data points will be used to adjust predictions. If
<code>error_correct_cols</code> is not <code>NULL</code>, mean error will be used within those
groups instead of overall mean error.</p></dd>
<dt>error_correct_cols</dt>
<dd><p>Column names of data frame to group by when applying
error correction to the predicted values.</p></dd>
<dt>shift_trend</dt>
<dd><p>Logical value specifying whether or not to shift predictions
so that the trend matches up to the last observation. If <code>error_correct</code> and
<code>shift_trend</code> are both <code>TRUE</code>, <code>shift_trend</code> takes precedence.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Depending on the value passed to <code>ret</code>, either a data frame with
predicted data, a vector of errors from <code><a href="model_error.html">model_error()</a></code>, a fitted model, or a list with all 3.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>predict_..._avg_trend()</code> functions need to be used carefully. Ensure that <code>average_cols</code>
and variables in the <code>formula</code> match, and any <code>formula</code> variables not in <code>average_cols</code>
are numeric that can be averaged. Even though the modeling won't use the <code>group_col</code>,
it should be provided if necessary to be used in error metric calculations, and provision
of <code>types</code> into <code>type_col</code>. Similarly, the <code>sort_col</code> is necessary for <code>types</code>, but
<strong>also needs to be in <code>average_cols</code></strong> if <code>error_correct</code>, <code>group_models</code>, or <code>shift_trend</code> is
going to be used.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Seth Caldwell, William Msemburi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

