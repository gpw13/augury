<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="augury">
<title>INLA modeling • augury</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="INLA modeling">
<meta property="og:description" content="augury">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">augury</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/average-trend.html">Average trend modeling</a>
    <a class="dropdown-item" href="../articles/forecast-modeling.html">Forecast modeling</a>
    <a class="dropdown-item" href="../articles/inla-modeling.html">INLA modeling</a>
    <a class="dropdown-item" href="../articles/simple-methods.html">Simple prediction methods</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gpw13/augury/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="inla-modeling_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>INLA modeling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gpw13/augury/blob/HEAD/vignettes/inla-modeling.Rmd" class="external-link"><code>vignettes/inla-modeling.Rmd</code></a></small>
      <div class="d-none name"><code>inla-modeling.Rmd</code></div>
    </div>

    
    
<p>In order to show the INLA modeling wrappers provided in augury, we will look at two datasets publicly available on the World Health Organization’s Global Health Observatory. These can be accessed using the <a href="https://github.com/caldwellst/ghost" class="external-link">ghost package</a>, which provides an R interface for the GHO OData API.</p>
<div class="section level2">
<h2 id="time-series-modeling">Time series modeling<a class="anchor" aria-label="anchor" href="#time-series-modeling"></a>
</h2>
<p>The first indicator will be on safe sanitation. We will also use the <a href="https://github.com/caldwellst/billionaiRe" class="external-link">billionaiRe</a> package to quickly transform the GHO data into the simple format used by augury, billionaiRe, and other packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gpw13/augury" class="external-link">augury</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">ghost</span><span class="fu">::</span><span class="fu"><a href="https://gpw13.github.io/ghost/reference/gho_data.html" class="external-link">gho_data</a></span><span class="op">(</span><span class="st">"WSH_SANITATION_SAFELY_MANAGED"</span>,
                      query <span class="op">=</span> <span class="st">"$filter=Dim1 eq 'TOTL'"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">billionaiRe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/billionaiRe/man/wrangle_gho_data.html" class="external-link">wrangle_gho_data</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"WHO GHO"</span>,
                                type <span class="op">=</span> <span class="st">"estimated"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 15</span></span>
<span class="co">#&gt;   iso3   year ind   value lower upper use_dash use_calc source type  type_detail</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFG    <span style="text-decoration: underline;">2</span>000 hpop…    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     WHO G… esti… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AFG    <span style="text-decoration: underline;">2</span>001 hpop…    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     WHO G… esti… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AFG    <span style="text-decoration: underline;">2</span>002 hpop…    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     WHO G… esti… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> AFG    <span style="text-decoration: underline;">2</span>003 hpop…    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     WHO G… esti… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> AFG    <span style="text-decoration: underline;">2</span>004 hpop…    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     WHO G… esti… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> AFG    <span style="text-decoration: underline;">2</span>005 hpop…    <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     WHO G… esti… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 4 more variables: other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   scenario &lt;chr&gt;, scenario_detail &lt;chr&gt;</span></span></code></pre></div>
<p>Now that we have the input data available from the GHO in an easy to use format, we can now join up with the <code>covariates_df</code> available in augury and run a time series model to predict sanitation out to 2023. For simplicity, let’s just look at Albania, with ISO3 code <code>"ALB"</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">covariates_df</span>,
                <span class="va">df</span>,
                by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso3</span> <span class="op">==</span> <span class="st">"ALB"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 24</span></span>
<span class="co">#&gt;   iso3   year year_n region       un_subregion gbd_subregion sdg_subregion   sdi</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ALB    <span style="text-decoration: underline;">2</span>000      1 Southern Eu… 39                      42 917           0.604</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ALB    <span style="text-decoration: underline;">2</span>001      2 Southern Eu… 39                      42 917           0.61 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ALB    <span style="text-decoration: underline;">2</span>002      3 Southern Eu… 39                      42 917           0.614</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ALB    <span style="text-decoration: underline;">2</span>003      4 Southern Eu… 39                      42 917           0.619</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ALB    <span style="text-decoration: underline;">2</span>004      5 Southern Eu… 39                      42 917           0.625</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ALB    <span style="text-decoration: underline;">2</span>005      6 Southern Eu… 39                      42 917           0.632</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 16 more variables: sdi_scaled &lt;dbl&gt;, e0 &lt;dbl&gt;, e0_scaled &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ind &lt;chr&gt;, value &lt;dbl&gt;, lower &lt;lgl&gt;, upper &lt;lgl&gt;, use_dash &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   use_calc &lt;lgl&gt;, source &lt;chr&gt;, type &lt;chr&gt;, type_detail &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;, scenario &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   scenario_detail &lt;chr&gt;</span></span></code></pre></div>
<p>Of course, the only “covariate” being used in this time series model is going to be <code>year_n</code>, but the rest are available if we want to expand to test other types of modeling. Let’s run the modeling now. We are going to scale the data and probit transform it before and after the modeling. We will use the <code><a href="../reference/predict_inla_ts.html">predict_inla_ts()</a></code> to fit a time series model to the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modeled_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/scale_transform.html">scale_transform</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/probit_transform.html">probit_transform</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/predict_inla_ts.html">predict_inla_ts</a></span><span class="op">(</span>type_col <span class="op">=</span> <span class="st">"type"</span>,
                  source_col <span class="op">=</span> <span class="st">"source"</span>,
                  source <span class="op">=</span> <span class="st">"augury modeling"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/probit_transform.html">probit_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"pred"</span>, <span class="st">"upper"</span>, <span class="st">"lower"</span><span class="op">)</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/scale_transform.html">scale_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"pred"</span>, <span class="st">"upper"</span>, <span class="st">"lower"</span><span class="op">)</span>, divide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Only look at recent years and relevant columns</span>

<span class="va">modeled_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2015</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">value</span>, <span class="va">pred</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">source</span>, <span class="va">type</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 8</span></span>
<span class="co">#&gt;    iso3   year value  pred lower upper source          type     </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ALB    <span style="text-decoration: underline;">2</span>016  46.7  46.7    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ALB    <span style="text-decoration: underline;">2</span>017  47.1  47.1    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ALB    <span style="text-decoration: underline;">2</span>018  47.4  47.4    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ALB    <span style="text-decoration: underline;">2</span>019  47.6  47.6    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ALB    <span style="text-decoration: underline;">2</span>020  47.7  47.7    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ALB    <span style="text-decoration: underline;">2</span>021  47.9  47.9    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ALB    <span style="text-decoration: underline;">2</span>022  48.1  48.1    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ALB    <span style="text-decoration: underline;">2</span>023  48.2  48.2    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ALB    <span style="text-decoration: underline;">2</span>024  48.4  48.4    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ALB    <span style="text-decoration: underline;">2</span>025  48.6  48.6    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span></code></pre></div>
<p>And there we go, we have now fit a time series model to our data, provided new type and source, and merged this into our existing data frame. However, in this setup, the error calculations returned by <code><a href="../reference/predict_inla_ts.html">predict_inla_ts()</a></code> are calculated in the probit space. If we wanted to scale and probit transform the response variable prior to model fitting, but still calculate error metrics and automatically return the response and predicted values back in the original space, we can set <code>scale = 100</code> and <code>probit = TRUE</code> within <code><a href="../reference/predict_inla_ts.html">predict_inla_ts()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/predict_inla_ts.html">predict_inla_ts</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">100</span>,
                  probit <span class="op">=</span> <span class="cn">TRUE</span>,
                  type_col <span class="op">=</span> <span class="st">"type"</span>,
                  source_col <span class="op">=</span> <span class="st">"source"</span>,
                  source <span class="op">=</span> <span class="st">"augury modeling"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2015</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">value</span>, <span class="va">pred</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">source</span>, <span class="va">type</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 8</span></span>
<span class="co">#&gt;    iso3   year value  pred lower upper source          type     </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ALB    <span style="text-decoration: underline;">2</span>016  46.7  46.7    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ALB    <span style="text-decoration: underline;">2</span>017  47.1  47.1    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ALB    <span style="text-decoration: underline;">2</span>018  47.4  47.4    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ALB    <span style="text-decoration: underline;">2</span>019  47.6  47.6    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ALB    <span style="text-decoration: underline;">2</span>020  47.7  47.7    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO GHO         estimated</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ALB    <span style="text-decoration: underline;">2</span>021  47.9  47.9    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ALB    <span style="text-decoration: underline;">2</span>022  48.1  48.1    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ALB    <span style="text-decoration: underline;">2</span>023  48.2  48.2    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ALB    <span style="text-decoration: underline;">2</span>024  48.4  48.4    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ALB    <span style="text-decoration: underline;">2</span>025  48.6  48.6    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> augury modeling projected</span></code></pre></div>
<p>And we can see that the results here are the same as manually scaling and probit transforming the variables.</p>
</div>
<div class="section level2">
<h2 id="mixed-effects-modeling">Mixed-effects modeling<a class="anchor" aria-label="anchor" href="#mixed-effects-modeling"></a>
</h2>
<p>Now we will look at another indicator, a composite of 13 International Health Regulations core capacity scores, SPAR version. Since countries only have two data points at most, we will use mixed-effects modeling to infill and project the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">ghost</span><span class="fu">::</span><span class="fu"><a href="https://gpw13.github.io/ghost/reference/gho_data.html" class="external-link">gho_data</a></span><span class="op">(</span><span class="st">"SDGIHR2018"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">billionaiRe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/billionaiRe/man/wrangle_gho_data.html" class="external-link">wrangle_gho_data</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"Electronic State Parties Self-Assessment Annual Reporting Tool (e-SPAR)"</span>,
                                type <span class="op">=</span> <span class="st">"reported"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 15</span></span>
<span class="co">#&gt;   iso3   year ind   value lower upper use_dash use_calc source type  type_detail</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFG    <span style="text-decoration: underline;">2</span>018 espar    35 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     Elect… repo… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AFG    <span style="text-decoration: underline;">2</span>019 espar    43 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     Elect… repo… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AFG    <span style="text-decoration: underline;">2</span>020 espar    47 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     Elect… repo… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> AGO    <span style="text-decoration: underline;">2</span>018 espar    59 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     Elect… repo… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> AGO    <span style="text-decoration: underline;">2</span>019 espar    63 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     Elect… repo… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> AGO    <span style="text-decoration: underline;">2</span>020 espar    65 <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    TRUE     TRUE     Elect… repo… <span style="color: #BB0000;">NA</span>         </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 4 more variables: other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   scenario &lt;chr&gt;, scenario_detail &lt;chr&gt;</span></span></code></pre></div>
<p>With this, let’s go straight into the modeling like last time, except we will now use <code><a href="../reference/predict_inla_me.html">predict_inla_me()</a></code> for mixed-effects modeling using covariates found in <code>covariates_df</code>. This time, we want to model a first order auto-regressive process across time rather than a second-order random walk, so we use the <code>"ar1"</code> model available in INLA.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modeled_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">covariates_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/scale_transform.html">scale_transform</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/probit_transform.html">probit_transform</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/predict_inla_me.html">predict_inla_me</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"ar1"</span>,
                  type_col <span class="op">=</span> <span class="st">"type"</span>,
                  source_col <span class="op">=</span> <span class="st">"source"</span>,
                  source <span class="op">=</span> <span class="st">"WHO DDI Preliminary infilling and projections"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/probit_transform.html">probit_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"pred"</span>, <span class="st">"upper"</span>, <span class="st">"lower"</span><span class="op">)</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/scale_transform.html">scale_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"pred"</span>, <span class="st">"upper"</span>, <span class="st">"lower"</span><span class="op">)</span>, divide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Look at an example for Afghanistan</span>

<span class="va">modeled_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2017</span>, <span class="va">iso3</span> <span class="op">==</span> <span class="st">"AFG"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">value</span>, <span class="va">pred</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">source</span>, <span class="va">type</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 8</span></span>
<span class="co">#&gt;   iso3   year value  pred lower upper source                               type </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFG    <span style="text-decoration: underline;">2</span>018  35    40.6    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> Electronic State Parties Self-Asses… repo…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AFG    <span style="text-decoration: underline;">2</span>019  43    41.5    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> Electronic State Parties Self-Asses… repo…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> AFG    <span style="text-decoration: underline;">2</span>020  47    42.7    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> Electronic State Parties Self-Asses… repo…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> AFG    <span style="text-decoration: underline;">2</span>021  43.5  43.5    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO DDI Preliminary infilling and p… proj…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> AFG    <span style="text-decoration: underline;">2</span>022  44.6  44.6    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO DDI Preliminary infilling and p… proj…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> AFG    <span style="text-decoration: underline;">2</span>023  45.5  45.5    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO DDI Preliminary infilling and p… proj…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> AFG    <span style="text-decoration: underline;">2</span>024  46.5  46.5    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO DDI Preliminary infilling and p… proj…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span> AFG    <span style="text-decoration: underline;">2</span>025  47.4  47.4    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span> WHO DDI Preliminary infilling and p… proj…</span></code></pre></div>
<p>And exactly as we were able to do with the time series modeling, we now have infilled missing data for this indicator using mixed-effects modeling in INLA.</p>
</div>
<div class="section level2">
<h2 id="building-further">Building further<a class="anchor" aria-label="anchor" href="#building-further"></a>
</h2>
<p>Building further on this work, you can tweak any of the arguments passed to these INLA models or use the base <code><a href="../reference/predict_inla.html">predict_inla()</a></code> and other covariates to test and compare other models. There is much more functionality to test modeling accuracy and iteratively develop methods available in this package not shown here, so please continue to explore and play around.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Seth Caldwell, William Msemburi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
