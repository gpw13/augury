<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A set of functions designed to make public the methods
    used for data imputation and forecasting for global health statistics
    developed by the World Health Organization's Division of Data, Analytics
    and Delivery for Impact.">
<title>Provides Streamlined Methods for Data Imputation and Forecasting for WHO DDI Statistics • augury</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Provides Streamlined Methods for Data Imputation and Forecasting for WHO DDI Statistics">
<meta property="og:description" content="A set of functions designed to make public the methods
    used for data imputation and forecasting for global health statistics
    developed by the World Health Organization's Division of Data, Analytics
    and Delivery for Impact.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">augury</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/average-trend.html">Average trend modeling</a>
    <a class="dropdown-item" href="articles/forecast-modeling.html">Forecast modeling</a>
    <a class="dropdown-item" href="articles/inla-modeling.html">INLA modeling</a>
    <a class="dropdown-item" href="articles/simple-methods.html">Simple prediction methods</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gpw13/augury/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="augury-">augury 
<a class="anchor" aria-label="anchor" href="#augury-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The goal of augury is to streamline the process of fitting models to infill and forecast data, particularly for models used within the WHO’s Triple Billion framework.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install augury from <a href="https://github.com/gpw13/augury" class="external-link">GitHub</a>. The package depends on the <a href="https://www.r-inla.org/home" class="external-link">INLA package</a> which is not available on CRAN. You will need to separately install that prior to installing augury, following the code below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"INLA"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"INLA"</span>,repos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span>,INLA<span class="op">=</span><span class="st">"https://inla.r-inla-download.org/R/stable"</span><span class="op">)</span>, dep<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"gpw13/augury"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Most of the functions available through the package are designed to streamline fitting a model and replacing missing observations within a single data frame in one pass.</p>
<ul>
<li>
<code><a href="reference/predict_general_mdl.html">predict_general_mdl()</a></code> is a function that takes in a data frame, generic R modelling function (such as <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm</a></code>), and fits a model and returns newly projected data, error metrics, the fitted model itself, or a list of all 3.</li>
<li>
<code><a href="reference/predict_inla.html">predict_inla()</a></code> is a function similar to the above, except rather than taking a generic modelling function it accepts a formula and additional argument passed to <code><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">INLA::inla()</a></code> to perform Bayesian analysis of structured additive models.</li>
<li>
<code><a href="reference/predict_forecast.html">predict_forecast()</a></code> instead uses forecasting methods available from <code><a href="https://pkg.robjhyndman.com/forecast/reference/forecast.html" class="external-link">forecast::forecast()</a></code> to perform exponential smoothing or other time series models on a response variable.</li>
</ul>
<p>Given that models might need to be fit separately to different portions of a data frame, such as fitting time series models for each country individually, these functions now accept the argument <code>group_models</code> that determines whether to fit separate models to each group in the data frame before joining them back together into the original data frame.</p>
</div>
<div class="section level2">
<h2 id="additional-model-wrappers">Additional model wrappers<a class="anchor" aria-label="anchor" href="#additional-model-wrappers"></a>
</h2>
<p>Additional functions are provided as requested to streamlining fitting of specific models. For general modeling, there are grouped and individual functions for <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code>, <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code>, and <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code> to fit linear models, generalized linear models, and linear mixed-effects models respectively. These wrappers are:</p>
<ul>
<li><code><a href="reference/predict_lm.html">predict_lm()</a></code></li>
<li><code><a href="reference/predict_glm.html">predict_glm()</a></code></li>
<li><code><a href="reference/predict_lmer.html">predict_lmer()</a></code></li>
</ul>
<p>As well, wrappers are provided around INLA for models currently in place for the Triple Billion framework. These are a time series model with no additional covariates (fit individually by country) and a mixed-effects model using covariates.</p>
<ul>
<li><code><a href="reference/predict_inla_me.html">predict_inla_me()</a></code></li>
<li><code><a href="reference/predict_inla_ts.html">predict_inla_ts()</a></code></li>
</ul>
<p>And for forecasting, generic functions are provided for simple exponential smoothing and Holt’s linear trend exponential smoothing.</p>
<ul>
<li><code><a href="reference/predict_holt.html">predict_holt()</a></code></li>
<li><code><a href="reference/predict_ses.html">predict_ses()</a></code></li>
</ul>
</div>
<div class="section level2">
<h2 id="covariates">Covariates<a class="anchor" aria-label="anchor" href="#covariates"></a>
</h2>
<p>For convenience, the covariates used within the default INLA modeling are exported from the package and can be easily joined up to a data frame for use in modeling. These are available through <code><a href="reference/covariates_df.html">augury::covariates_df</a></code>.</p>
</div>
<div class="section level2">
<h2 id="grouped-trend-development">Grouped trend development<a class="anchor" aria-label="anchor" href="#grouped-trend-development"></a>
</h2>
<p>While we typically want to fit a model to a data set directly, augury has a set of <code>predict_..._avg_trend()</code> functions that allows you to average data by group (e.g. by region), fit the model to the grouped and averaged data, and extract that trend to apply to the original dataset. See the section below on <strong>Average trend modeling</strong> for more details.</p>
</div>
<div class="section level2">
<h2 id="error-metrics">Error metrics<a class="anchor" aria-label="anchor" href="#error-metrics"></a>
</h2>
<p>When doing model selection, it is always important to use metrics to evaluate model fit and predictive accuracy. All <code>predict_...</code> functions in augury use the same evaluation framework, implemented through <code><a href="reference/model_error.html">model_error()</a></code>. If a <code>test</code> column is defined, then the evaluation framework is only applied to this set</p>
</div>
<div class="section level2">
<h2 id="additional-functionality">Additional functionality<a class="anchor" aria-label="anchor" href="#additional-functionality"></a>
</h2>
<p>To help streamline other portions of the modeling process, some other functions are included in the package.</p>
<ul>
<li>
<code><a href="reference/probit_transform.html">probit_transform()</a></code> uses a probit transformation on select columns of a data frame, and inverses it if specified.</li>
<li>
<code><a href="reference/scale_transform.html">scale_transform()</a></code> scales a vector by a single number, very simple, and can inverse the scaling if specified.</li>
<li>
<code><a href="reference/predict_simple.html">predict_simple()</a></code> performs linear interpolation or flat extrapolation in the same manner as the other <code>predict_...</code> functions, but without modeling or confidence bounds.</li>
<li>
<code><a href="reference/predict_average.html">predict_average()</a></code> performs averaging by groups of columns in the same manner as the other <code>predict_...</code> functions, but without modeling or confidence bounds.</li>
</ul>
<p>Together, they can be used to transform and scale data for better modeling, and then inverse these to get data back into the original feature space.</p>
</div>
<div class="section level2">
<h2 id="inla-modeling-examples">INLA modeling examples<a class="anchor" aria-label="anchor" href="#inla-modeling-examples"></a>
</h2>
<p>In order to show the INLA modeling wrappers provided in augury, we will look at two datasets publicly available on the World Health Organization’s Global Health Observatory. These can be accessed using the <a href="https://github.com/caldwellst/ghost" class="external-link">ghost package</a>, which provides an R interface for the GHO OData API.</p>
</div>
<div class="section level2">
<h2 id="time-series-modeling">Time series modeling<a class="anchor" aria-label="anchor" href="#time-series-modeling"></a>
</h2>
<p>The first indicator will be on safe sanitation. We will also use the <a href="https://github.com/caldwellst/billionaiRe" class="external-link">billionaiRe</a> package to quickly transform the GHO data into the simple format used by augury, billionaiRe, and other packages.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gpw13/augury" class="external-link">augury</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">ghost</span><span class="fu">::</span><span class="fu"><a href="https://gpw13.github.io/ghost/reference/gho_data.html" class="external-link">gho_data</a></span><span class="op">(</span><span class="st">"WSH_SANITATION_SAFELY_MANAGED"</span>,
                      query <span class="op">=</span> <span class="st">"$filter=Dim1 eq 'TOTL'"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">billionaiRe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/billionaiRe/man/wrangle_gho_data.html" class="external-link">wrangle_gho_data</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"WHO GHO"</span>,
                                type <span class="op">=</span> <span class="st">"estimated"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 13</span>
<span class="co">#&gt;   iso3   year ind   value lower upper use_dash use_calc source type  type_detail</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;    &lt;lgl&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;      </span>
<span class="co">#&gt; 1 AFG    2000 hpop…    NA NA    NA    TRUE     TRUE     WHO G… esti… NA         </span>
<span class="co">#&gt; 2 AFG    2001 hpop…    NA NA    NA    TRUE     TRUE     WHO G… esti… NA         </span>
<span class="co">#&gt; 3 AFG    2002 hpop…    NA NA    NA    TRUE     TRUE     WHO G… esti… NA         </span>
<span class="co">#&gt; 4 AFG    2003 hpop…    NA NA    NA    TRUE     TRUE     WHO G… esti… NA         </span>
<span class="co">#&gt; 5 AFG    2004 hpop…    NA NA    NA    TRUE     TRUE     WHO G… esti… NA         </span>
<span class="co">#&gt; 6 AFG    2005 hpop…    NA NA    NA    TRUE     TRUE     WHO G… esti… NA         </span>
<span class="co">#&gt; # … with 2 more variables: other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;</span></code></pre></div>
<p>Now that we have the input data available from the GHO in an easy to use format, we can now join up with the <code>covariates_df</code> available in augury and run a time series model to predict sanitation out to 2023. For simplicity, let’s just look at Albania, with ISO3 code <code>"ALB"</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">covariates_df</span>,
                <span class="va">df</span>,
                by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso3</span> <span class="op">==</span> <span class="st">"ALB"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 19</span>
<span class="co">#&gt;   iso3   year year_n region    sdi sdi_scaled    e0 e0_scaled ind    value lower</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;lgl&gt;</span>
<span class="co">#&gt; 1 ALB    2000      1 Southe… 0.604      0.650  74.0     0.752 hpop_…  40.2 NA   </span>
<span class="co">#&gt; 2 ALB    2001      2 Southe… 0.61       0.657  74.3     0.759 hpop_…  40.5 NA   </span>
<span class="co">#&gt; 3 ALB    2002      3 Southe… 0.614      0.661  74.6     0.766 hpop_…  40.8 NA   </span>
<span class="co">#&gt; 4 ALB    2003      4 Southe… 0.619      0.667  74.8     0.771 hpop_…  41.1 NA   </span>
<span class="co">#&gt; 5 ALB    2004      5 Southe… 0.625      0.673  75.0     0.776 hpop_…  41.4 NA   </span>
<span class="co">#&gt; 6 ALB    2005      6 Southe… 0.632      0.681  75.2     0.780 hpop_…  41.9 NA   </span>
<span class="co">#&gt; # … with 8 more variables: upper &lt;lgl&gt;, use_dash &lt;lgl&gt;, use_calc &lt;lgl&gt;,</span>
<span class="co">#&gt; #   source &lt;chr&gt;, type &lt;chr&gt;, type_detail &lt;lgl&gt;, other_detail &lt;lgl&gt;,</span>
<span class="co">#&gt; #   upload_detail &lt;lgl&gt;</span></code></pre></div>
<p>Of course, the only “covariate” being used in this time series model is going to be <code>year_n</code>, but the rest are available if we want to expand to test other types of modeling. Let’s run the modeling now. We are going to scale the data and probit transform it before and after the modeling. We will use the <code><a href="reference/predict_inla_ts.html">predict_inla_ts()</a></code> to fit a time series model to the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modeled_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/scale_transform.html">scale_transform</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/probit_transform.html">probit_transform</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/predict_inla_ts.html">predict_inla_ts</a></span><span class="op">(</span>type_col <span class="op">=</span> <span class="st">"type"</span>,
                  source_col <span class="op">=</span> <span class="st">"source"</span>,
                  source <span class="op">=</span> <span class="st">"augury modeling"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/probit_transform.html">probit_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"pred"</span>, <span class="st">"upper"</span>, <span class="st">"lower"</span><span class="op">)</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/scale_transform.html">scale_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"pred"</span>, <span class="st">"upper"</span>, <span class="st">"lower"</span><span class="op">)</span>, divide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Only look at recent years and relevant columns</span>

<span class="va">modeled_df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2015</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">value</span>, <span class="va">pred</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">source</span>, <span class="va">type</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 × 8</span>
<span class="co">#&gt;    iso3   year value  pred lower upper source          type     </span>
<span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    </span>
<span class="co">#&gt;  1 ALB    2016  46.7  46.7    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  2 ALB    2017  47.1  47.1    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  3 ALB    2018  47.4  47.4    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  4 ALB    2019  47.6  47.6    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  5 ALB    2020  47.7  47.7    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  6 ALB    2021  47.9  47.9    NA    NA augury modeling projected</span>
<span class="co">#&gt;  7 ALB    2022  48.1  48.1    NA    NA augury modeling projected</span>
<span class="co">#&gt;  8 ALB    2023  48.2  48.2    NA    NA augury modeling projected</span>
<span class="co">#&gt;  9 ALB    2024  48.4  48.4    NA    NA augury modeling projected</span>
<span class="co">#&gt; 10 ALB    2025  48.6  48.6    NA    NA augury modeling projected</span></code></pre></div>
<p>And there we go, we have now fit a time series model to our data, provided new type and source, and merged this into our existing data frame. However, in this setup, the error calculations returned by <code><a href="reference/predict_inla_ts.html">predict_inla_ts()</a></code> are calculated in the probit space. If we wanted to scale and probit transform the response variable prior to model fitting, but still calculate error metrics and automatically return the response and predicted values back in the original space, we can set <code>scale = 100</code> and <code>probit = TRUE</code> within <code><a href="reference/predict_inla_ts.html">predict_inla_ts()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/predict_inla_ts.html">predict_inla_ts</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">100</span>,
                  probit <span class="op">=</span> <span class="cn">TRUE</span>,
                  type_col <span class="op">=</span> <span class="st">"type"</span>,
                  source_col <span class="op">=</span> <span class="st">"source"</span>,
                  source <span class="op">=</span> <span class="st">"augury modeling"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2015</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">value</span>, <span class="va">pred</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">source</span>, <span class="va">type</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 × 8</span>
<span class="co">#&gt;    iso3   year value  pred lower upper source          type     </span>
<span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    </span>
<span class="co">#&gt;  1 ALB    2016  46.7  46.7    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  2 ALB    2017  47.1  47.1    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  3 ALB    2018  47.4  47.4    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  4 ALB    2019  47.6  47.6    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  5 ALB    2020  47.7  47.7    NA    NA WHO GHO         estimated</span>
<span class="co">#&gt;  6 ALB    2021  47.9  47.9    NA    NA augury modeling projected</span>
<span class="co">#&gt;  7 ALB    2022  48.1  48.1    NA    NA augury modeling projected</span>
<span class="co">#&gt;  8 ALB    2023  48.2  48.2    NA    NA augury modeling projected</span>
<span class="co">#&gt;  9 ALB    2024  48.4  48.4    NA    NA augury modeling projected</span>
<span class="co">#&gt; 10 ALB    2025  48.6  48.6    NA    NA augury modeling projected</span></code></pre></div>
<p>And we can see that the results here are the same as manually scaling and probit transforming the variables.</p>
</div>
<div class="section level2">
<h2 id="mixed-effects-modeling">Mixed-effects modeling<a class="anchor" aria-label="anchor" href="#mixed-effects-modeling"></a>
</h2>
<p>Now we will look at another indicator, a composite of 13 International Health Regulations core capacity scores, SPAR version. Since countries only have two data points at most, we will use mixed-effects modeling to infill and project the data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">ghost</span><span class="fu">::</span><span class="fu"><a href="https://gpw13.github.io/ghost/reference/gho_data.html" class="external-link">gho_data</a></span><span class="op">(</span><span class="st">"SDGIHR2018"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">billionaiRe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/billionaiRe/man/wrangle_gho_data.html" class="external-link">wrangle_gho_data</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"Electronic State Parties Self-Assessment Annual Reporting Tool (e-SPAR)"</span>,
                                type <span class="op">=</span> <span class="st">"reported"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 13</span>
<span class="co">#&gt;   iso3   year ind   value lower upper use_dash use_calc source type  type_detail</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;    &lt;lgl&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;      </span>
<span class="co">#&gt; 1 AFG    2018 espar    35 NA    NA    TRUE     TRUE     Elect… repo… NA         </span>
<span class="co">#&gt; 2 AFG    2019 espar    43 NA    NA    TRUE     TRUE     Elect… repo… NA         </span>
<span class="co">#&gt; 3 AFG    2020 espar    47 NA    NA    TRUE     TRUE     Elect… repo… NA         </span>
<span class="co">#&gt; 4 AGO    2018 espar    59 NA    NA    TRUE     TRUE     Elect… repo… NA         </span>
<span class="co">#&gt; 5 AGO    2019 espar    63 NA    NA    TRUE     TRUE     Elect… repo… NA         </span>
<span class="co">#&gt; 6 AGO    2020 espar    65 NA    NA    TRUE     TRUE     Elect… repo… NA         </span>
<span class="co">#&gt; # … with 2 more variables: other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;</span></code></pre></div>
<p>With this, let’s go straight into the modeling like last time, except we will now use <code><a href="reference/predict_inla_me.html">predict_inla_me()</a></code> for mixed-effects modeling using covariates found in <code>covariates_df</code>. This time, we want to model a first order auto-regressive process across time rather than a second-order random walk, so we use the <code>"ar1"</code> model available in INLA.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modeled_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">covariates_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/scale_transform.html">scale_transform</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/probit_transform.html">probit_transform</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/predict_inla_me.html">predict_inla_me</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"ar1"</span>,
                  type_col <span class="op">=</span> <span class="st">"type"</span>,
                  source_col <span class="op">=</span> <span class="st">"source"</span>,
                  source <span class="op">=</span> <span class="st">"WHO DDI Preliminary infilling and projections"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/probit_transform.html">probit_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"pred"</span>, <span class="st">"upper"</span>, <span class="st">"lower"</span><span class="op">)</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/scale_transform.html">scale_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"pred"</span>, <span class="st">"upper"</span>, <span class="st">"lower"</span><span class="op">)</span>, divide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Look at an example for Afghanistan</span>

<span class="va">modeled_df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2017</span>, <span class="va">iso3</span> <span class="op">==</span> <span class="st">"AFG"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">value</span>, <span class="va">pred</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">source</span>, <span class="va">type</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 × 8</span>
<span class="co">#&gt;   iso3   year value  pred lower upper source                              type  </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                               &lt;chr&gt; </span>
<span class="co">#&gt; 1 AFG    2018  35    40.6    NA    NA Electronic State Parties Self-Asse… repor…</span>
<span class="co">#&gt; 2 AFG    2019  43    41.5    NA    NA Electronic State Parties Self-Asse… repor…</span>
<span class="co">#&gt; 3 AFG    2020  47    42.7    NA    NA Electronic State Parties Self-Asse… repor…</span>
<span class="co">#&gt; 4 AFG    2021  43.5  43.5    NA    NA WHO DDI Preliminary infilling and … proje…</span>
<span class="co">#&gt; 5 AFG    2022  44.5  44.5    NA    NA WHO DDI Preliminary infilling and … proje…</span>
<span class="co">#&gt; 6 AFG    2023  45.4  45.4    NA    NA WHO DDI Preliminary infilling and … proje…</span>
<span class="co">#&gt; 7 AFG    2024  46.4  46.4    NA    NA WHO DDI Preliminary infilling and … proje…</span>
<span class="co">#&gt; 8 AFG    2025  47.3  47.3    NA    NA WHO DDI Preliminary infilling and … proje…</span></code></pre></div>
<p>And exactly as we were able to do with the time series modeling, we now have infilled missing data for this indicator using mixed-effects modeling in INLA.</p>
</div>
<div class="section level2">
<h2 id="building-further">Building further<a class="anchor" aria-label="anchor" href="#building-further"></a>
</h2>
<p>Building further on this work, you can tweak any of the arguments passed to these INLA models or use the base <code><a href="reference/predict_inla.html">predict_inla()</a></code> and other covariates to test and compare other models. There is much more functionality to test modeling accuracy and iteratively develop methods available in this package not shown here, so please continue to explore and play around.</p>
</div>
<div class="section level2">
<h2 id="forecasting-examples">Forecasting examples<a class="anchor" aria-label="anchor" href="#forecasting-examples"></a>
</h2>
<p>To look at using forecast methods to predict data, we will again be using the <a href="https://github.com/caldwellst/ghost" class="external-link">ghost package</a>, which provides an R interface for the GHO OData API and accessing data on blood pressure. We will load in data for the USA and Great Britain initially, which provide full time series from 1975 to 2015.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gpw13/augury" class="external-link">augury</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">ghost</span><span class="fu">::</span><span class="fu"><a href="https://gpw13.github.io/ghost/reference/gho_data.html" class="external-link">gho_data</a></span><span class="op">(</span><span class="st">"BP_04"</span>, query <span class="op">=</span> <span class="st">"$filter=SpatialDim in ('USA', 'GBR') and Dim1 eq 'MLE' and Dim2 eq 'YEARS18-PLUS'"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">billionaiRe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/billionaiRe/man/wrangle_gho_data.html" class="external-link">wrangle_gho_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>iso3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USA"</span>, <span class="st">"GBR"</span><span class="op">)</span>,
                                       year <span class="op">=</span> <span class="fl">1975</span><span class="op">:</span><span class="fl">2017</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Some of the rows are missing a source value.</span>
<span class="co">#&gt; Joining, by = c("iso3", "year")</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 13</span>
<span class="co">#&gt;   iso3   year ind   value lower upper use_dash use_calc source type  type_detail</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt;    &lt;lgl&gt;  &lt;chr&gt; &lt;lgl&gt;      </span>
<span class="co">#&gt; 1 GBR    1975 bp     37.8  26.7  49.1 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 2 GBR    1976 bp     37.6  27.4  48   TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 3 GBR    1977 bp     37.3  27.9  46.8 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 4 GBR    1978 bp     37.1  28.4  45.9 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 5 GBR    1979 bp     36.9  28.8  45.2 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 6 GBR    1980 bp     36.7  29.2  44.4 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; # … with 2 more variables: other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;</span></code></pre></div>
<p>With this data, we can now use the <code><a href="reference/predict_forecast.html">predict_forecast()</a></code> function like we would any of the other <code>predict_...</code> functions from augury to forecast out to 2017. First, we will do this just on USA data and use the <code><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html" class="external-link">forecast::holt</a></code> to forecast using exponential smoothing.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">iso3</span> <span class="op">==</span> <span class="st">"USA"</span><span class="op">)</span>

<span class="fu"><a href="reference/predict_forecast.html">predict_forecast</a></span><span class="op">(</span><span class="va">usa_df</span>,
                 <span class="fu">forecast</span><span class="fu">::</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html" class="external-link">holt</a></span>,
                 <span class="st">"value"</span>,
                 sort_col <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2012</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'quantmod':</span>
<span class="co">#&gt;   method            from</span>
<span class="co">#&gt;   as.zoo.data.frame zoo</span>
<span class="co">#&gt; # A tibble: 6 × 16</span>
<span class="co">#&gt;   iso3   year ind   value lower upper use_dash use_calc source type  type_detail</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt;    &lt;lgl&gt;  &lt;chr&gt; &lt;lgl&gt;      </span>
<span class="co">#&gt; 1 USA    2012 bp     15.7  11.7  20.3 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 2 USA    2013 bp     15.5  11.2  20.8 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 3 USA    2014 bp     15.4  10.8  21.3 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 4 USA    2015 bp     15.3  10.4  21.8 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 5 USA    2016 &lt;NA&gt;   15.2  NA    NA   NA       NA       NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 6 USA    2017 &lt;NA&gt;   15.1  NA    NA   NA       NA       NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; # … with 5 more variables: other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;, pred &lt;dbl&gt;,</span>
<span class="co">#&gt; #   pred_upper &lt;dbl&gt;, pred_lower &lt;dbl&gt;</span></code></pre></div>
<p>Of course, we might want to run these models all together for each country individually. In this case, we can use the <code>group_models = TRUE</code> function to perform the forecast individually by country. To save a bit of limited time, let’s use the wrapper <code><a href="reference/predict_holt.html">predict_holt()</a></code> to automatically supply <code><a href="https://pkg.robjhyndman.com/forecast/reference/ses.html" class="external-link">forecast::holt</a></code> as the forecasting function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/predict_holt.html">predict_holt</a></span><span class="op">(</span><span class="va">df</span>,
             response <span class="op">=</span> <span class="st">"value"</span>,
             group_col <span class="op">=</span> <span class="st">"iso3"</span>,
             group_models <span class="op">=</span> <span class="cn">TRUE</span>,
             sort_col <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2014</span>, <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2017</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 8 × 16</span>
<span class="co">#&gt;   iso3   year ind   value lower upper use_dash use_calc source type  type_detail</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt;    &lt;lgl&gt;  &lt;chr&gt; &lt;lgl&gt;      </span>
<span class="co">#&gt; 1 GBR    2014 bp     18.5  14    23.3 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 2 GBR    2015 bp     17.9  13    23.2 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 3 GBR    2016 &lt;NA&gt;   17.3  NA    NA   NA       NA       NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 4 GBR    2017 &lt;NA&gt;   16.7  NA    NA   NA       NA       NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 5 USA    2014 bp     15.4  10.8  21.3 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 6 USA    2015 bp     15.3  10.4  21.8 TRUE     TRUE     NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 7 USA    2016 &lt;NA&gt;   15.2  NA    NA   NA       NA       NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; 8 USA    2017 &lt;NA&gt;   15.1  NA    NA   NA       NA       NA     &lt;NA&gt;  NA         </span>
<span class="co">#&gt; # … with 5 more variables: other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;, pred &lt;dbl&gt;,</span>
<span class="co">#&gt; #   pred_upper &lt;dbl&gt;, pred_lower &lt;dbl&gt;</span></code></pre></div>
<p>Et voila, we have the same results for the USA and have also ran forecasting on Great Britain as well. However, you should be careful on the data that is supplied for forecasting. The <code>forecast</code> package functions default to using the longest, contiguous non-missing data for forecasting. <code>augury</code> instead automatically pulls the latest contiguous observed data to use for forecasting, to ensure that older data is not prioritized over new data. However, this means any break in a time series will prevent data before that from being used.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bad_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="cn">NA</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="reference/predict_holt.html">predict_holt</a></span><span class="op">(</span><span class="va">bad_df</span>, <span class="st">"x"</span>, group_col <span class="op">=</span> <span class="cn">NULL</span>, sort_col <span class="op">=</span> <span class="cn">NULL</span>, group_models <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 11 × 6</span>
<span class="co">#&gt;         x   pred pred_upper pred_lower upper lower</span>
<span class="co">#&gt;     &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1  1     NA          NA        NA        NA    NA</span>
<span class="co">#&gt;  2  2     NA          NA        NA        NA    NA</span>
<span class="co">#&gt;  3  3     NA          NA        NA        NA    NA</span>
<span class="co">#&gt;  4  4     NA          NA        NA        NA    NA</span>
<span class="co">#&gt;  5 NA     NA          NA        NA        NA    NA</span>
<span class="co">#&gt;  6  3     NA          NA        NA        NA    NA</span>
<span class="co">#&gt;  7  2     NA          NA        NA        NA    NA</span>
<span class="co">#&gt;  8  1.17   1.17        2.55     -0.217    NA    NA</span>
<span class="co">#&gt;  9  0.338  0.338       2.33     -1.66     NA    NA</span>
<span class="co">#&gt; 10 -0.494 -0.494       2.14     -3.12     NA    NA</span>
<span class="co">#&gt; 11 -1.32  -1.32        1.98     -4.63     NA    NA</span></code></pre></div>
<p>It’s advisable to consider if other data infilling or imputation methods should be used to generate a full time series prior to the use of forecasting methods to prevent issues like above from impacting the predictive accuracy.</p>
</div>
<div class="section level2">
<h2 id="simple-prediction-methods">Simple prediction methods<a class="anchor" aria-label="anchor" href="#simple-prediction-methods"></a>
</h2>
<p>The simple methods available in augury are easy to use, but provide the same functionality of allowing a test column and returning error metrics as the more complex modeling functions available in the package. Let’s use data on alcohol from the GHO to demonstrate the functionality.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gpw13/augury" class="external-link">augury</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">ghost</span><span class="fu">::</span><span class="fu"><a href="https://gpw13.github.io/ghost/reference/gho_data.html" class="external-link">gho_data</a></span><span class="op">(</span><span class="st">"SA_0000001688"</span>,
                      query <span class="op">=</span> <span class="st">"$filter=Dim1 eq 'BTSX'"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">billionaiRe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/billionaiRe/man/wrangle_gho_data.html" class="external-link">wrangle_gho_data</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"WHO GHO"</span>,
                                type <span class="op">=</span> <span class="st">"estimated"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 13</span>
<span class="co">#&gt;   iso3   year ind     value lower upper use_dash use_calc source  type  type_detail</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;lgl&gt;      </span>
<span class="co">#&gt; 1 AFG    2000 alcohol   0     0     0.1 TRUE     TRUE     WHO GHO esti… NA         </span>
<span class="co">#&gt; 2 AFG    2005 alcohol   0     0     0.1 TRUE     TRUE     WHO GHO esti… NA         </span>
<span class="co">#&gt; 3 AFG    2010 alcohol   0     0     0.1 TRUE     TRUE     WHO GHO esti… NA         </span>
<span class="co">#&gt; 4 AFG    2015 alcohol   0     0     0   TRUE     TRUE     WHO GHO esti… NA         </span>
<span class="co">#&gt; 5 AFG    2019 alcohol   0     0     0.1 TRUE     TRUE     WHO GHO esti… NA         </span>
<span class="co">#&gt; 6 AGO    2000 alcohol   3.3   2.4   4.4 TRUE     TRUE     WHO GHO esti… NA         </span>
<span class="co">#&gt; # … with 2 more variables: other_detail &lt;lgl&gt;, upload_detail &lt;lgl&gt;</span></code></pre></div>
<p>Here we can see that data has time series and gaps in years. We can use linear interpolation and flat extrapolation here to get data out to 2023.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>iso3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">iso3</span><span class="op">)</span>,
                         year <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2023</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span>

<span class="va">df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso3</span> <span class="op">==</span> <span class="st">"AFG"</span>,
                <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span>,
                <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2018</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>,
                <span class="va">year</span>,
                <span class="va">value</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 9 × 3</span>
<span class="co">#&gt;   iso3   year value</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 AFG    2010     0</span>
<span class="co">#&gt; 2 AFG    2011    NA</span>
<span class="co">#&gt; 3 AFG    2012    NA</span>
<span class="co">#&gt; 4 AFG    2013    NA</span>
<span class="co">#&gt; 5 AFG    2014    NA</span>
<span class="co">#&gt; 6 AFG    2015     0</span>
<span class="co">#&gt; 7 AFG    2016    NA</span>
<span class="co">#&gt; 8 AFG    2017    NA</span>
<span class="co">#&gt; 9 AFG    2018    NA</span></code></pre></div>
<p>Let’s now use our linear interpolation and flat extrapolation on this data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/predict_simple.html">predict_simple</a></span><span class="op">(</span><span class="va">df</span>,
                          group_col <span class="op">=</span> <span class="st">"iso3"</span>,
                          sort_col <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span> 

<span class="va">pred_df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso3</span> <span class="op">==</span> <span class="st">"AFG"</span>,
                <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span>,
                <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2018</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">value</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 9 × 3</span>
<span class="co">#&gt;   iso3   year value</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 AFG    2010     0</span>
<span class="co">#&gt; 2 AFG    2011     0</span>
<span class="co">#&gt; 3 AFG    2012     0</span>
<span class="co">#&gt; 4 AFG    2013     0</span>
<span class="co">#&gt; 5 AFG    2014     0</span>
<span class="co">#&gt; 6 AFG    2015     0</span>
<span class="co">#&gt; 7 AFG    2016     0</span>
<span class="co">#&gt; 8 AFG    2017     0</span>
<span class="co">#&gt; 9 AFG    2018     0</span></code></pre></div>
<p>And we can see our linear interpolation there. We can also see the flat extrapolation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso3</span> <span class="op">==</span> <span class="st">"AFG"</span>,
                <span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2016</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">value</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 7 × 3</span>
<span class="co">#&gt;   iso3   year value</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 AFG    2017     0</span>
<span class="co">#&gt; 2 AFG    2018     0</span>
<span class="co">#&gt; 3 AFG    2019     0</span>
<span class="co">#&gt; 4 AFG    2020     0</span>
<span class="co">#&gt; 5 AFG    2021     0</span>
<span class="co">#&gt; 6 AFG    2022     0</span>
<span class="co">#&gt; 7 AFG    2023     0</span></code></pre></div>
<p>We can use the <code><a href="reference/predict_average.html">predict_average()</a></code> function in much the same way, except it is most useful when we have robust series for a set of countries, and no data for others. We can then use something like the regional average to infill data for missing countries.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">ghost</span><span class="fu">::</span><span class="fu"><a href="https://gpw13.github.io/ghost/reference/gho_data.html" class="external-link">gho_data</a></span><span class="op">(</span><span class="st">"PHE_HHAIR_PROP_POP_CLEAN_FUELS"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">billionaiRe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/billionaiRe/man/wrangle_gho_data.html" class="external-link">wrangle_gho_data</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"WHO GHO"</span>,
                                type <span class="op">=</span> <span class="st">"estimated"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">whoville</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whoville/man/is_who_member.html" class="external-link">is_who_member</a></span><span class="op">(</span><span class="va">iso3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: Some of the rows are missing a ind value.</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">whoville</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whoville/man/who_member_states.html" class="external-link">who_member_states</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">df</span><span class="op">$</span><span class="va">iso3</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; [1] "LBN" "CUB" "BGR" "LBY"</span></code></pre></div>
<p>Above, we have 4 missing WHO member states, Lebanon, Cuba, Bulgaria, and Libya. Let’s use regional averaging to fill in this data. We can use the most recent World Bank income groups from the <a href="https://github.com/caldwellst/whoville" class="external-link">whoville package</a> as our relevant group.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span>iso3 <span class="op">=</span> <span class="va">x</span>,
                         year <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2018</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu">whoville</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whoville/man/iso3_to_regions.html" class="external-link">iso3_to_regions</a></span><span class="op">(</span><span class="va">iso3</span>, region <span class="op">=</span> <span class="st">"wb_ig"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="reference/predict_average.html">predict_average</a></span><span class="op">(</span><span class="va">df</span>,
                average_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="st">"year"</span><span class="op">)</span>,
                group_col <span class="op">=</span> <span class="st">"iso3"</span>,
                sort_col <span class="op">=</span> <span class="st">"year"</span>,
                type_col <span class="op">=</span> <span class="st">"type"</span>,
                source_col <span class="op">=</span> <span class="st">"source"</span>,
                source <span class="op">=</span> <span class="st">"WB IG regional averages"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso3</span> <span class="op">==</span> <span class="st">"LBN"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 19 × 15</span>
<span class="co">#&gt;    iso3   year ind   value lower upper use_dash use_calc source           type  </span>
<span class="co">#&gt;    &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt;    &lt;chr&gt;            &lt;chr&gt; </span>
<span class="co">#&gt;  1 LBN    2000 &lt;NA&gt;   67.2    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt;  2 LBN    2001 &lt;NA&gt;   68.2    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt;  3 LBN    2002 &lt;NA&gt;   69.2    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt;  4 LBN    2003 &lt;NA&gt;   70.2    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt;  5 LBN    2004 &lt;NA&gt;   71.2    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt;  6 LBN    2005 &lt;NA&gt;   72.2    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt;  7 LBN    2006 &lt;NA&gt;   73.1    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt;  8 LBN    2007 &lt;NA&gt;   74.0    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt;  9 LBN    2008 &lt;NA&gt;   74.8    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 10 LBN    2009 &lt;NA&gt;   75.6    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 11 LBN    2010 &lt;NA&gt;   76.3    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 12 LBN    2011 &lt;NA&gt;   77.0    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 13 LBN    2012 &lt;NA&gt;   77.6    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 14 LBN    2013 &lt;NA&gt;   78.2    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 15 LBN    2014 &lt;NA&gt;   78.7    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 16 LBN    2015 &lt;NA&gt;   79.2    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 17 LBN    2016 &lt;NA&gt;   79.7    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 18 LBN    2017 &lt;NA&gt;   80.1    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; 19 LBN    2018 &lt;NA&gt;   80.5    NA    NA NA       NA       WB IG regional … imput…</span>
<span class="co">#&gt; # … with 5 more variables: type_detail &lt;lgl&gt;, other_detail &lt;lgl&gt;,</span>
<span class="co">#&gt; #   upload_detail &lt;lgl&gt;, region &lt;chr&gt;, pred &lt;dbl&gt;</span></code></pre></div>
<p>Hope these examples have been clear and highlight some of the usefulness of these simple modelling functions.</p>
</div>
<div class="section level2">
<h2 id="average-trend-modeling">Average trend modeling<a class="anchor" aria-label="anchor" href="#average-trend-modeling"></a>
</h2>
<p>While we most often want to directly build models on our original dataset to generate predicted values, we might instead want to generate average trends across larger groups instead, and then apply this to our original data. For instance, generating trends by region, and then applying those regional trends back to the country level. The <code>predict_...avg_trend()</code> functions in augury allow us to do just that, applying any of the models we are used to a grouped set of columns.</p>
<p>These work across specific groups, specified by <code>average_cols</code>, and averaging numeric values specified as the response variable or variables extracted from a <code>formula</code>. The specified model is then fit to this averaged data, and the predicted values are joined back up to the original data frame. Let’s look at an example using blood pressure data, which has a comprehensive time series.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gpw13/augury" class="external-link">augury</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">ghost</span><span class="fu">::</span><span class="fu"><a href="https://gpw13.github.io/ghost/reference/gho_data.html" class="external-link">gho_data</a></span><span class="op">(</span><span class="st">"BP_04"</span>, query <span class="op">=</span> <span class="st">"$filter=Dim1 eq 'MLE' and Dim2 eq 'YEARS18-PLUS'"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">billionaiRe</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/billionaiRe/man/wrangle_gho_data.html" class="external-link">wrangle_gho_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">covariates_df</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso3</span>, <span class="va">year</span>, <span class="va">year_n</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">whoville</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whoville/man/is_who_member.html" class="external-link">is_who_member</a></span><span class="op">(</span><span class="va">iso3</span><span class="op">)</span>,                <span class="co"># keep WHO member states</span>
                <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2000</span>, <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2023</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>               <span class="co"># get relevant years  </span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>who_region <span class="op">=</span> <span class="fu">whoville</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/whoville/man/iso3_to_regions.html" class="external-link">iso3_to_regions</a></span><span class="op">(</span><span class="va">iso3</span><span class="op">)</span><span class="op">)</span> <span class="co"># get WHO regions</span>
<span class="co">#&gt; Warning: Some of the rows are missing a source value.</span>
<span class="co">#&gt; Joining, by = c("iso3", "year")</span>

<span class="va">ur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">who_region</span><span class="op">)</span>
<span class="va">ur</span>
<span class="co">#&gt; [1] "EMR"  "AFR"  "EUR"  "AMR"  "WPR"  "SEAR"</span></code></pre></div>
<p>Alright, so, here we have 6 WHO regions. We will use these regions to fit a model to and use INLA to predict out to 2023, then apply these trends to input countries.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/predict_inla_avg_trend.html">predict_inla_avg_trend</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">value</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">year_n</span>, model <span class="op">=</span> <span class="st">"rw2"</span><span class="op">)</span>,
                         average_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who_region"</span>, <span class="st">"year_n"</span><span class="op">)</span>,
                         group_models <span class="op">=</span> <span class="cn">TRUE</span>,
                         group_col <span class="op">=</span> <span class="st">"iso3"</span>,
                         sort_col <span class="op">=</span> <span class="st">"year_n"</span><span class="op">)</span>

<span class="va">pred_df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso3</span> <span class="op">==</span> <span class="st">"AFG"</span>, <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2013</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 11 × 10</span>
<span class="co">#&gt;    iso3   year year_n value who_region  pred pred_upper pred_lower upper lower</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 AFG    2013     14  30.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt;  2 AFG    2014     15  30.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt;  3 AFG    2015     16  30.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt;  4 AFG    2016     17  29.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt;  5 AFG    2017     18  29.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt;  6 AFG    2018     19  29.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt;  7 AFG    2019     20  29.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt;  8 AFG    2020     21  29.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt;  9 AFG    2021     22  29.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt; 10 AFG    2022     23  29.4 EMR         29.4       29.4       29.4    NA    NA</span>
<span class="co">#&gt; 11 AFG    2023     24  29.4 EMR         29.4       29.4       29.4    NA    NA</span></code></pre></div>
<p>Above, we can see we have a generated a model using 2nd order random walk with INLA, however, the model was generated by averaging data to WHO regions first, fitting the random walk to each reach (since <code>group_models = TRUE</code>) and then fitting those trends to the original data. Note some specifics of what had to be set, as the <code>predict_..._avg_trend()</code> functions are slightly more complex than others:</p>
<ul>
<li>
<code>average_cols</code> must contain the <code>sort_col</code>. So, since we use <code>year_n</code> in the time series rather than <code>year</code>, we will sort by that this time.</li>
<li>
<code>average_cols</code> refers to the groupings used for averaging (we take the average for each WHO region and year in this case). Then, the model is fit to <code>average_cols</code> that are NOT the <code>sort_col</code>.</li>
<li>
<code>group_col</code> is the groupings used on the <em>original data frame</em>, which is still necessary here when applying the trend back to the original data.</li>
<li>If a variable is in <code>formula</code>, it must either be in <code>average_cols</code> or it must be a numeric column that can be averaged. This is because the formula is applied to the data frame <em>after</em> <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarize()</a></code> have reduced it.</li>
</ul>
<p>To highlight this point, in the above example, what’s actually happening is we are actually fitting the model on the summarized data:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">who_region</span>, <span class="va">year_n</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'who_region'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; # A tibble: 6 × 3</span>
<span class="co">#&gt; # Groups:   who_region [1]</span>
<span class="co">#&gt;   who_region year_n value</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 AFR             1  29.7</span>
<span class="co">#&gt; 2 AFR             2  29.6</span>
<span class="co">#&gt; 3 AFR             3  29.5</span>
<span class="co">#&gt; 4 AFR             4  29.4</span>
<span class="co">#&gt; 5 AFR             5  29.3</span>
<span class="co">#&gt; 6 AFR             6  29.2</span></code></pre></div>
<p>Since <code>average_cols = c("who_region", "year_n")</code>, we took the mean of all values in <code>formula</code> not in <code>average_cols</code>, in this case just <code>value</code>. If for instance, we tried to specify a model using <code>iso3</code> in the <code>formula</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/predict_inla_avg_trend.html">predict_inla_avg_trend</a></span><span class="op">(</span><span class="va">df</span>,
                       formula <span class="op">=</span> <span class="va">value</span> <span class="op">~</span> <span class="va">iso3</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">year_n</span>, model <span class="op">=</span> <span class="st">"rw2"</span><span class="op">)</span>,
                       average_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who_region"</span>, <span class="st">"year_n"</span><span class="op">)</span>,
                       group_models <span class="op">=</span> <span class="cn">TRUE</span>,
                       group_col <span class="op">=</span> <span class="st">"iso3"</span>,
                       sort_col <span class="op">=</span> <span class="st">"year_n"</span><span class="op">)</span>
<span class="co">#&gt; Error: iso3 must be numeric columns for use in averaging, or included in `average_cols` for grouping.</span></code></pre></div>
<p>We get an error message indicating that iso3 must be numeric or included in <code>average_cols</code> for grouping. This is because without it being numeric or in the <code>average_cols</code>, there’s no way <code>dplyr::group_by() %&gt;% dplyr::summarize()</code> a non-numeric column automatically (how would we reduce country-level ISO3 codes to the regional level?).</p>
<p>While slightly complex, ensuring you follow the above means you should easily and successfully get out meaningful trend predictions for your data frames using trends generated on grouped data.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/gpw13/augury/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/gpw13/augury/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing augury</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Seth Caldwell <br><small class="roles"> Author, maintainer </small>  </li>
<li>William Msemburi <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/gpw13/augury/actions" class="external-link"><img src="https://github.com/gpw13/augury/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Seth Caldwell, William Msemburi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
